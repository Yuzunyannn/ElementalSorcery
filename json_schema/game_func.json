{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "definitions": {
        "TriggerFunc": {
            "oneOf": [
                {
                    "$ref": "#"
                },
                {
                    "type": "array",
                    "items": {
                        "$ref": "#"
                    }
                }
            ]
        },
        "TimesFunc": {
            "properties": {
                "times": {
                    "type": "number",
                    "minimum": 1
                }
            }
        },
        "LootFunc": {
            "properties": {
                "times": {
                    "type": "number",
                    "minimum": 1
                },
                "loot": {
                    "$ref": "#/definitions/Loot"
                },
                "acceptHideItem": {
                    "type": "boolean",
                    "default": true
                }
            }
        },
        "Loot": {
            "anyOf": [
                {
                    "$ref": "./mult_loot.json"
                },
                {
                    "type": "string",
                    "pattern": "\\$.*"
                }
            ],
            "examples": [
                "elementalsorcery:common/",
                "elementalsorcery:dungeon/"
            ]
        }
    },
    "type": "object",
    "required": [
        "type"
    ],
    "properties": {
        "type": {
            "enum": [
                "nothing",
                "ref",
                "entity",
                "group",
                "chest",
                "loot",
                "haystack",
                "explode",
                "dungeon:global"
            ]
        },
        "probability": {
            "type": "number",
            "default": 0.5
        },
        "trigger": {
            "title": "触发器",
            "additionalProperties": {
                "$ref": "#/definitions/TriggerFunc"
            }
        },
        "inject": {
            "type": "boolean",
            "default": true
        },
        "params": {
            "type": "object"
        }
    },
    "allOf": [
        {
            "if": {
                "properties": {
                    "type": {
                        "const": "ref"
                    }
                }
            },
            "then": {
                "title": "引用",
                "required": [
                    "/assets"
                ],
                "properties": {
                    "/assets": {
                        "type": "string",
                        "examples": [
                            "elementalsorcery:dungeon/"
                        ]
                    }
                }
            }
        },
        {
            "if": {
                "properties": {
                    "type": {
                        "const": "group"
                    }
                }
            },
            "then": {
                "title": "函数组",
                "required": [
                    "funcs"
                ],
                "properties": {
                    "funcs": {
                        "type": "array",
                        "items": {
                            "$ref": "#"
                        }
                    },
                    "mode": {
                        "enum": [
                            "parallel",
                            "sequence",
                            "random"
                        ]
                    }
                },
                "if": {
                    "properties": {
                        "mode": {
                            "const": "random"
                        }
                    }
                },
                "then": {
                    "properties": {
                        "funcs": {
                            "type": "array",
                            "items": {
                                "allOf": [
                                    {
                                        "$ref": "#"
                                    },
                                    {
                                        "properties": {
                                            "weight": {
                                                "type": "number"
                                            }
                                        }
                                    }
                                ]
                            }
                        }
                    }
                }
            }
        },
        {
            "if": {
                "properties": {
                    "type": {
                        "const": "chest"
                    }
                }
            },
            "then": {
                "title": "箱子构建",
                "allOf": [
                    {
                        "$ref": "#/definitions/LootFunc"
                    },
                    {
                        "properties": {}
                    }
                ]
            }
        },
        {
            "if": {
                "properties": {
                    "type": {
                        "const": "haystack"
                    }
                }
            },
            "then": {
                "title": "稻草堆",
                "allOf": [
                    {
                        "$ref": "#/definitions/TimesFunc"
                    },
                    {
                        "properties": {
                            "trigger": {
                                "properties": {
                                    "onSweep": {
                                        "$ref": "#/definitions/TriggerFunc"
                                    }
                                },
                                "additionalProperties": false
                            },
                            "highLevel": {
                                "type": "number",
                                "maximum": 16,
                                "minimum": 1,
                                "default": 1
                            },
                            "pressure": {
                                "type": [
                                    "boolean",
                                    "string"
                                ],
                                "default": "random"
                            }
                        }
                    }
                ]
            }
        },
        {
            "if": {
                "properties": {
                    "type": {
                        "const": "entity"
                    }
                }
            },
            "then": {
                "title": "实体构建",
                "required": [
                    "entityId"
                ],
                "allOf": [
                    {
                        "$ref": "#/definitions/TimesFunc"
                    },
                    {
                        "properties": {
                            "entityId": {
                                "anyOf": [
                                    {
                                        "type": "string"
                                    },
                                    {
                                        "$ref": "./entity_ids.json"
                                    }
                                ]
                            },
                            "trigger": {
                                "properties": {
                                    "onLoot": {
                                        "$ref": "#/definitions/TriggerFunc"
                                    }
                                },
                                "additionalProperties": false
                            }
                        }
                    }
                ]
            }
        },
        {
            "if": {
                "properties": {
                    "type": {
                        "const": "loot"
                    }
                }
            },
            "then": {
                "title": "掉落奖励",
                "required": [
                    "loot"
                ],
                "allOf": [
                    {
                        "$ref": "#/definitions/LootFunc"
                    },
                    {
                        "properties": {
                            "clearOrigin": {
                                "title": "清除原始掉落",
                                "type": "boolean",
                                "default": true
                            },
                            "goodPattern": {
                                "type": "boolean",
                                "default": true
                            }
                        }
                    }
                ]
            }
        },
        {
            "if": {
                "properties": {
                    "type": {
                        "const": "explode"
                    }
                }
            },
            "then": {
                "title": "爆炸",
                "allOf": [
                    {
                        "$ref": "#/definitions/TimesFunc"
                    },
                    {
                        "properties": {
                            "level": {
                                "type": "number",
                                "default": -2
                            }
                        }
                    }
                ]
            }
        }
    ]
}